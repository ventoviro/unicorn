!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.S3Uploader=t():e.S3Uploader=t()}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{S3Uploader:()=>d,create:()=>s,destroy:()=>p,get:()=>i,getInstance:()=>r,init:()=>a});const o={};let n;function r(e,t={}){return o[e]||(o[e]=s(e,t)),o[e]}function i(e){return Promise.resolve(s(e))}function s(e,t={}){return new d(e,t)}function p(e){delete o[e]}function a(e){n=e,n.inject("$loader").asImported("s3.uploader")}const l={endpoint:"",subfolder:"",viewerHost:"",starts_with:[],formInputs:{acl:"",bucket:"",key:"",Policy:"","X-Amz-Algorithm":"","X-Amz-Credential":"","X-Amz-Date":"","X-Amz-Signature":""}};function c(e,...t){return n.inject("$helper").defaultsDeep(e,...t)}class d extends(Unicorn.mix(class{}).with(Unicorn.EventMixin)){name;options;constructor(e,t={}){super(),this.name=e;const o=n.data("@s3.uploader."+e)||{};this.options=c({},t,o,l)}async upload(e,t,o={}){const r=new FormData,i=c({},o.formInputs||{},this.options.formInputs);"string"==typeof e&&(e=new Blob([e],{type:o["Content-Type"]||"text/plain"})),(e instanceof Blob||e instanceof File)&&(o["Content-Type"]=o["Content-Type"]||e.type),o.filename&&(o["Content-Disposition"]="attachment; filename*=UTF-8''"+encodeURIComponent(o.filename)),o.key=u(this.options.subfolder||"")+"/"+u(t),o.key=u(o.key),o["Content-Type"]=o["Content-Type"]||void 0,o["Content-Disposition"]=o["Content-Disposition"]||void 0;for(let e in i)r.set(e,i[e]);for(let e of Object.keys(this.options.starts_with))o[e]&&r.set(e,o[e]);r.append("file",e),this.trigger("start",r);try{let e=await n.inject("$http").post(this.options.endpoint||"",r,{onUploadProgress:e=>{o.onUploadProgress&&o.onUploadProgress(e),this.trigger("upload-progress",e),null!=e.total&&this.trigger("progress",e.loaded/e.total,e)}});const i=this.options.viewerHost+"/"+u(t);return this.trigger("success",i,e),e.url=i,e}finally{this.trigger("end")}}}function u(e){return e.replace(/^\/+|\/+$/g,"")}return t})()));
//# sourceMappingURL=main.js.map