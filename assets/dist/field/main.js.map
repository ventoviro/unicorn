{"version":3,"file":"cascade-select.js","mappings":"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","sources":["webpack://./src/modules/field/cascade-select.ts/webpack/universalModuleDefinition","webpack://./src/modules/field/cascade-select.ts/../../../../node_modules/@rubenbimmel/alpine-class-component/dist/alpineComponent.js","webpack://./src/modules/field/cascade-select.ts/../../../../node_modules/@rubenbimmel/alpine-class-component/dist/decorators/component.js","webpack://./src/modules/field/cascade-select.ts/webpack/bootstrap","webpack://./src/modules/field/cascade-select.ts/webpack/runtime/make namespace object","webpack://./src/modules/field/cascade-select.ts/./src/modules/field/cascade-select.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"CascadeSelect\"] = factory();\n\telse\n\t\troot[\"CascadeSelect\"] = factory();\n})(self, () => {\nreturn ","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass AlpineComponent {\r\n}\r\nexports.default = AlpineComponent;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction Component(component) {\r\n    return function (...args) {\r\n        let instance = new component(...args);\r\n        const proto = component.prototype;\r\n        let data = {};\r\n        Object.getOwnPropertyNames(proto).forEach(function (key) {\r\n            if (key === 'constructor') {\r\n                return;\r\n            }\r\n            const descriptor = Object.getOwnPropertyDescriptor(proto, key);\r\n            if (descriptor.value !== void 0) {\r\n                if (typeof descriptor.value === 'function') {\r\n                    data[key] = descriptor.value;\r\n                }\r\n            }\r\n            else if (descriptor.get || descriptor.set) {\r\n                Object.defineProperty(data, key, { get: descriptor.get, set: descriptor.set });\r\n            }\r\n        });\r\n        return Object.assign(data, instance);\r\n    };\r\n}\r\nexports.default = Component;\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/// <reference types=\"../../../types/index\" />\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar _a;\n// import from 'alpinejs';\nimport AlpineComponent from '@rubenbimmel/alpine-class-component/dist/alpineComponent';\nimport Component from '@rubenbimmel/alpine-class-component/dist/decorators/component';\nconst defaultOptions = {\n    id: '',\n    selected: '',\n    path: [],\n    ignoreSelf: null,\n    placeholder: '- Select -',\n    placeholders: [],\n    ajaxUrl: '',\n    ajaxValueField: 'value',\n    source: [],\n    labels: [],\n    labelWidth: 'col-md-3',\n    fieldWidth: 'col',\n    readonly: false,\n    disabled: false,\n    valueField: 'id',\n    textField: 'title',\n    horizontal: null,\n    horizontalColWidth: null,\n    defaultValue: '',\n    onSelectInit: () => {\n    },\n    onChange: () => {\n    },\n    onValueInit: () => {\n    },\n};\nlet CascadeSelect = class CascadeSelect extends AlpineComponent {\n    options;\n    el;\n    canModify = false;\n    lists = [];\n    ajaxUrl = '';\n    values = [];\n    constructor(options = {}) {\n        super();\n        this.options = u.defaultsDeep({}, options, defaultOptions);\n        this.options.id = this.options.id || 'cascade-select-' + u.uid();\n    }\n    init() {\n        this.canModify = !this.options.readonly && !this.options.disabled;\n        this.ajaxUrl = this.options.ajaxUrl;\n        this.values = this.options.path.slice().map(String);\n        let values = this.options.path.slice();\n        if (values.length === 0) {\n            values = [null];\n        }\n        else {\n            values.unshift(null);\n        }\n        let promise = Promise.resolve();\n        let lastValue = null;\n        values.forEach((v, i) => {\n            promise = promise.then(() => {\n                return this.loadItems(v, i).then((list) => {\n                    if (list.length > 0) {\n                        this.lists.push(list);\n                    }\n                });\n            });\n            lastValue = v;\n        });\n        this.el = this.$el;\n        u.module(this.$el, 'cascade.select', () => this);\n        this.valueInit(this.$el, lastValue, values);\n    }\n    getLabel(i) {\n        return this.options.labels[i] || `Level ${i + 1}`;\n    }\n    getId(i) {\n        return `${this.options.id}__level-${i}`;\n    }\n    getListValue(i) {\n        return this.values[i] || '';\n    }\n    isSelected(i, item) {\n        return String(this.getListValue(i)) === String(item[this.options.valueField]);\n    }\n    getFinalValue() {\n        const values = this.values.slice();\n        if (values.length === 0) {\n            return this.options.defaultValue;\n        }\n        const v = values\n            .filter(v => v != null)\n            .filter(v => v !== '')\n            .pop();\n        if (v == undefined) {\n            return this.options.defaultValue;\n        }\n        return v;\n    }\n    getLevel() {\n        return this.values.length;\n    }\n    async onChange(i, event) {\n        const el = event.target;\n        this.values[i] = el.value;\n        this.options.onChange(event);\n        event.stopPropagation();\n        const changeEvent = new CustomEvent('change', {\n            detail: {\n                el,\n                component: this,\n                value: el.value,\n                path: this.values\n            }\n        });\n        this.el?.dispatchEvent(changeEvent);\n        if (el.value === '') {\n            // Clear child\n            this.lists.splice(i + 1);\n            this.values.splice(i + 1);\n            return;\n        }\n        // Get child list\n        let list = await this.loadItems(el.value, i);\n        this.lists.splice(i + 1);\n        this.values.splice(i + 1);\n        if (list.length > 0) {\n            this.lists.push(list);\n        }\n    }\n    async loadItems(parentId, i) {\n        // Ajax\n        if (this.ajaxUrl) {\n            let res = await u.$http.get(this.ajaxUrl, {\n                params: {\n                    [this.options.ajaxValueField]: parentId,\n                    self: this.options.ignoreSelf || null\n                }\n            });\n            return await res.data.data;\n        }\n        // Source\n        if (parentId) {\n            return Promise.resolve(this.handleSourceItems(this.findFromList(this.lists[i - 1] || [], parentId)?.children || []));\n        }\n        return Promise.resolve(this.handleSourceItems(this.options.source));\n    }\n    valueInit($select, value, path) {\n        const event = new CustomEvent('value.init', {\n            detail: {\n                el: $select,\n                component: this,\n                value,\n                path\n            }\n        });\n        this.options.onSelectInit(event);\n        this.$el.dispatchEvent(event);\n    }\n    selectInit($select) {\n        const event = new CustomEvent('select.init', {\n            detail: {\n                el: $select,\n                component: this,\n            }\n        });\n        this.options.onSelectInit(event);\n        this.$el.dispatchEvent(event);\n    }\n    handleSourceItems(items) {\n        return items.map(item => {\n            return {\n                [this.options.valueField]: item.value[this.options.valueField],\n                [this.options.textField]: item.value[this.options.textField],\n                children: item.children\n            };\n        })\n            .filter(item => {\n            if (this.options.ignoreSelf) {\n                return item[this.options.valueField] != this.options.ignoreSelf;\n            }\n            return item;\n        });\n    }\n    findFromList(items, value) {\n        const found = items.filter(item => item[this.options.valueField] == value);\n        return found.shift();\n    }\n    getPlaceholder(i) {\n        if (this.options.placeholders[i]) {\n            return this.options.placeholders[i];\n        }\n        return this.options.placeholder;\n    }\n};\nCascadeSelect = __decorate([\n    Component,\n    __metadata(\"design:paramtypes\", [typeof (_a = typeof Partial !== \"undefined\" && Partial) === \"function\" ? _a : Object])\n], CascadeSelect);\nS.import('@main').then(() => {\n    u.loadAlpine(() => {\n        Alpine.data('CascadeSelect', CascadeSelect);\n    });\n});\n"],"names":["root","factory","exports","module","define","amd","self","component","args","instance","proto","prototype","data","Object","getOwnPropertyNames","forEach","key","descriptor","getOwnPropertyDescriptor","value","get","set","defineProperty","assign","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","r","Symbol","toStringTag","_a","defaultOptions","id","selected","path","ignoreSelf","placeholder","placeholders","ajaxUrl","ajaxValueField","source","labels","labelWidth","fieldWidth","readonly","disabled","valueField","textField","horizontal","horizontalColWidth","defaultValue","onSelectInit","onChange","onValueInit","CascadeSelect","options","el","canModify","lists","values","constructor","super","this","u","defaultsDeep","uid","init","slice","map","String","length","unshift","promise","Promise","resolve","lastValue","v","i","then","loadItems","list","push","$el","valueInit","getLabel","getId","getListValue","isSelected","item","getFinalValue","filter","pop","getLevel","event","target","stopPropagation","changeEvent","CustomEvent","detail","dispatchEvent","splice","parentId","res","$http","params","handleSourceItems","findFromList","children","$select","selectInit","items","shift","getPlaceholder","decorators","desc","d","c","arguments","Reflect","decorate","__decorate","k","metadata","__metadata","Partial","S","import","loadAlpine","Alpine"],"sourceRoot":""}