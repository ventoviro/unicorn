!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(self,(()=>(()=>{"use strict";var t={};(t=>{void 0!==o&&o.toStringTag&&Object.defineProperty(t,o.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const e="object"==typeof global&&global&&global.Object===Object&&global;var r="object"==typeof self&&self&&self.Object===Object&&self;const n=e||r||Function("return this")();var o=n.Symbol;const c=o;var a=Object.prototype,i=a.hasOwnProperty,l=a.toString,s=c?c.toStringTag:void 0;var p=Object.prototype.toString;var f=c?c.toStringTag:void 0;const d=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":f&&f in Object(t)?function(t){var e=i.call(t,s),r=t[s];try{t[s]=void 0;var n=!0}catch(t){}var o=l.call(t);return n&&(e?t[s]=r:delete t[s]),o}(t):function(t){return p.call(t)}(t)},v=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},b=function(t){if(!v(t))return!1;var e=d(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},y=n["__core-js_shared__"];var h,g=(h=/[^.]+$/.exec(y&&y.keys&&y.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"";var j=Function.prototype.toString;var m=/^\[object .+?Constructor\]$/,_=Function.prototype,O=Object.prototype,S=_.toString,x=O.hasOwnProperty,w=RegExp("^"+S.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const q=function(t){return!(!v(t)||(e=t,g&&g in e))&&(b(t)?w:m).test(function(t){if(null!=t){try{return j.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e},A=function(){try{var t=function(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return q(r)?r:void 0}(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),E=function(t,e,r){"__proto__"==e&&A?A(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},P=function(t,e){return t===e||t!=t&&e!=e};var $=Object.prototype.hasOwnProperty;const T=function(t,e,r){var n=t[e];$.call(t,e)&&P(n,r)&&(void 0!==r||e in t)||E(t,e,r)},C=function(t){return t},F=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)};var k=Math.max;const R=function(t){return function(){return t}},L=A?function(t,e){return A(t,"toString",{configurable:!0,enumerable:!1,value:R(e),writable:!0})}:C;var U=Date.now;const M=(I=L,D=0,B=0,function(){var t=U(),e=16-(t-B);if(B=t,e>0){if(++D>=800)return arguments[0]}else D=0;return I.apply(void 0,arguments)});var I,D,B;const N=function(t,e){return M(function(t,e,r){return e=k(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,c=k(n.length-e,0),a=Array(c);++o<c;)a[o]=n[e+o];o=-1;for(var i=Array(e+1);++o<e;)i[o]=n[o];return i[e]=r(a),F(t,this,i)}}(t,e,C),t+"")},H=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},z=function(t){return null!=t&&H(t.length)&&!b(t)};var G=/^(?:0|[1-9]\d*)$/;const J=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&G.test(t))&&t>-1&&t%1==0&&t<e},K=function(t,e,r){if(!v(r))return!1;var n=typeof e;return!!("number"==n?z(r)&&J(e,r.length):"string"==n&&e in r)&&P(r[e],t)},V=function(t){return null!=t&&"object"==typeof t},W=function(t){return V(t)&&"[object Arguments]"==d(t)};var Q=Object.prototype,X=Q.hasOwnProperty,Y=Q.propertyIsEnumerable,Z=W(function(){return arguments}())?W:function(t){return V(t)&&X.call(t,"callee")&&!Y.call(t,"callee")};const tt=Z,et=Array.isArray;var rt="object"==typeof exports&&exports&&!exports.nodeType&&exports,nt=rt&&"object"==typeof module&&module&&!module.nodeType&&module,ot=nt&&nt.exports===rt?n.Buffer:void 0;const ct=(ot?ot.isBuffer:void 0)||function(){return!1};var at={};at["[object Float32Array]"]=at["[object Float64Array]"]=at["[object Int8Array]"]=at["[object Int16Array]"]=at["[object Int32Array]"]=at["[object Uint8Array]"]=at["[object Uint8ClampedArray]"]=at["[object Uint16Array]"]=at["[object Uint32Array]"]=!0,at["[object Arguments]"]=at["[object Array]"]=at["[object ArrayBuffer]"]=at["[object Boolean]"]=at["[object DataView]"]=at["[object Date]"]=at["[object Error]"]=at["[object Function]"]=at["[object Map]"]=at["[object Number]"]=at["[object Object]"]=at["[object RegExp]"]=at["[object Set]"]=at["[object String]"]=at["[object WeakMap]"]=!1;var it="object"==typeof exports&&exports&&!exports.nodeType&&exports,ut=it&&"object"==typeof module&&module&&!module.nodeType&&module,lt=ut&&ut.exports===it&&e.process,st=function(){try{return ut&&ut.require&&ut.require("util").types||lt&&lt.binding&&lt.binding("util")}catch(t){}}(),pt=st&&st.isTypedArray;const ft=pt?function(t){return function(e){return t(e)}}(pt):function(t){return V(t)&&H(t.length)&&!!at[d(t)]};var dt=Object.prototype.hasOwnProperty;const vt=function(t,e){var r=et(t),n=!r&&tt(t),o=!r&&!n&&ct(t),c=!r&&!n&&!o&&ft(t),a=r||n||o||c,i=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=i.length;for(var l in t)!e&&!dt.call(t,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||c&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||J(l,u))||i.push(l);return i};var bt=Object.prototype;const yt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||bt)};var ht=Object.prototype.hasOwnProperty;const gt=function(t){if(!v(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=yt(t),r=[];for(var n in t)("constructor"!=n||!e&&ht.call(t,n))&&r.push(n);return r},jt=(mt=function(t,e,r,n){!function(t,e,r,n){var o=!r;r||(r={});for(var c=-1,a=e.length;++c<a;){var i=e[c],u=n?n(r[i],t[i],i,r,t):void 0;void 0===u&&(u=t[i]),o?E(r,i,u):T(r,i,u)}}(e,function(t){return z(t)?vt(t,!0):gt(t)}(e),t,n)},N((function(t,e){var r=-1,n=e.length,o=n>1?e[n-1]:void 0,c=n>2?e[2]:void 0;for(o=mt.length>3&&"function"==typeof o?(n--,o):void 0,c&&K(e[0],e[1],c)&&(o=n<3?void 0:o,n=1),t=Object(t);++r<n;){var a=e[r];a&&mt(t,a,r,o)}return t})));var mt;const _t=function(t,e){return function(r){return t(e(r))}},Ot=_t(Object.getPrototypeOf,Object);var St=Function.prototype,xt=Object.prototype,wt=St.toString,qt=xt.hasOwnProperty,At=wt.call(Object);const Et=function(t){if(!V(t))return!1;var e=d(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!function(t){if(!V(t)||"[object Object]"!=d(t))return!1;var e=Ot(t);if(null===e)return!0;var r=qt.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&wt.call(r)==At}(t)},Pt=N((function(t,e){try{return F(t,void 0,e)}catch(t){return Et(t)?t:new Error(t)}})),$t=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o};var Tt=Object.prototype,Ct=Tt.hasOwnProperty;const Ft=function(t,e,r,n){return void 0===t||P(t,Tt[r])&&!Ct.call(n,r)?e:t};var kt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};const Rt=function(t){return"\\"+kt[t]},Lt=_t(Object.keys,Object);var Ut=Object.prototype.hasOwnProperty;const Mt=function(t){return z(t)?vt(t):function(t){if(!yt(t))return Lt(t);var e=[];for(var r in Object(t))Ut.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)},It=/<%=([\s\S]+?)%>/g,Dt=(Bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(t){return null==Bt?void 0:Bt[t]});var Bt;var Nt=c?c.prototype:void 0,Ht=Nt?Nt.toString:void 0;const zt=function t(e){if("string"==typeof e)return e;if(et(e))return $t(e,t)+"";if(function(t){return"symbol"==typeof t||V(t)&&"[object Symbol]"==d(t)}(e))return Ht?Ht.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r},Gt=function(t){return null==t?"":zt(t)};var Jt=/[&<>"']/g,Kt=RegExp(Jt.source);const Vt={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:It,variable:"",imports:{_:{escape:function(t){return(t=Gt(t))&&Kt.test(t)?t.replace(Jt,Dt):t}}}};var Wt=/\b__p \+= '';/g,Qt=/\b(__p \+=) '' \+/g,Xt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Yt=/[()=,{}\[\]\/\s]/,Zt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,te=/($^)/,ee=/['\n\r\u2028\u2029\\]/g,re=Object.prototype.hasOwnProperty;const ne=function(t,e,r){var n=Vt.imports._.templateSettings||Vt;r&&K(t,e,r)&&(e=void 0),t=Gt(t),e=jt({},e,n,Ft);var o,c,a=jt({},e.imports,n.imports,Ft),i=Mt(a),u=function(t,e){return $t(e,(function(e){return t[e]}))}(a,i),l=0,s=e.interpolate||te,p="__p += '",f=RegExp((e.escape||te).source+"|"+s.source+"|"+(s===It?Zt:te).source+"|"+(e.evaluate||te).source+"|$","g"),d=re.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+"\n":"";t.replace(f,(function(e,r,n,a,i,u){return n||(n=a),p+=t.slice(l,u).replace(ee,Rt),r&&(o=!0,p+="' +\n__e("+r+") +\n'"),i&&(c=!0,p+="';\n"+i+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),l=u+e.length,e})),p+="';\n";var v=re.call(e,"variable")&&e.variable;if(v){if(Yt.test(v))throw new Error("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(c?p.replace(Wt,""):p).replace(Qt,"$1").replace(Xt,"$1;"),p="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(c?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var b=Pt((function(){return Function(i,d+"return "+p).apply(void 0,u)}));if(b.source=p,Et(b))throw b;return b};class oe extends HTMLElement{get listContainer(){return this.querySelector("[data-role=list-container]")}get modal(){return document.querySelector(this.options.modalSelector)}get items(){return this.listContainer.children}connectedCallback(){this.options=JSON.parse(this.getAttribute("options")||"{}"),this.itemTemplate=ne(document.querySelector(this.options.itemTemplate).innerHTML);const t=this.querySelector("[data-role=empty]");t&&(t.name=t.dataset.name),this.options.sortable&&u.import("@sortablejs").then((()=>{new Sortable(this.listContainer,{handle:".h-drag-handle"})}));const e=this.querySelector("[data-role=select]");e.addEventListener("click",(t=>{this.open(t)})),this.querySelector("[data-role=clear]").addEventListener("click",(()=>{[].forEach.call(this.items,(t=>{t.querySelector("[data-role=remove]").click()}))})),e.style.pointerEvents=null,this.render()}render(){(u.data("unicorn.modal-field")[this.options.dataKey]||[]).forEach((t=>{this.append(t)}))}append(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=u.html(this.itemTemplate({item:t}));r.dataset.value=t.value,r.querySelector("[data-role=remove]").addEventListener("click",(()=>{u.$ui.slideUp(r).then((()=>{r.remove(),this.toggleRequired()}))})),this.listContainer.appendChild(r),this.toggleRequired(),e&&u.$ui.highlight(r)}toggleRequired(){const t=this.querySelector("[data-role=validation-placeholder]");t&&(t.disabled=0!==this.listContainer.children.length)}open(t){t.preventDefault(),t.stopPropagation();const e=this.options.max;e&&this.listContainer.children.length>=e?alert(u.__("unicorn.field.modal.max.selected",e)):this.modal.open(t.target.href,{size:"modal-xl"})}}var ce,ae;return ae="uni-modal-list","is"in(ce=oe)?Object.defineProperty(ce,"is",{value:ae,enumerable:!0,configurable:!0,writable:!0}):ce.is=ae,u.defineCustomElement(oe.is,oe),u.use(class{static install(t){t.$modalField=new this(t)}constructor(t){this.app=t}createCallback(t,e,r){return"list"===t?t=>{const n=document.querySelector(e);n.querySelector(`[data-value="${t.value}"]`)?alert(u.__("unicorn.field.modal.already.selected")):(n.append(t,!0),document.querySelector(r).close())}:t=>{const n=document.querySelector(e),o=n.querySelector("[data-role=image]"),c=n.querySelector("[data-role=title]"),a=n.querySelector("[data-role=value]");o&&t.image&&(o.style.backgroundImage=`url(${t.image});`),c.value=t.title||"",a.value=t.value||"",a.dispatchEvent(new CustomEvent("change")),document.querySelector(r).close(),u.$ui.highlight(c)}}}),t})()));
//# sourceMappingURL=modal-field.js.map