!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ModalField=e():t.ModalField=e()}(self,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{ModalField:()=>re});const r="object"==typeof global&&global&&global.Object===Object&&global;var n="object"==typeof self&&self&&self.Object===Object&&self;const o=r||n||Function("return this")(),c=o.Symbol;var a=Object.prototype,i=a.hasOwnProperty,l=a.toString,s=c?c.toStringTag:void 0;var p=Object.prototype.toString;var f=c?c.toStringTag:void 0;const d=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":f&&f in Object(t)?function(t){var e=i.call(t,s),r=t[s];try{t[s]=void 0;var n=!0}catch(t){}var o=l.call(t);return n&&(e?t[s]=r:delete t[s]),o}(t):function(t){return p.call(t)}(t)},y=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},b=function(t){if(!y(t))return!1;var e=d(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},v=o["__core-js_shared__"];var h,g=(h=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"";var j=Function.prototype.toString;var m=/^\[object .+?Constructor\]$/,_=Function.prototype,O=Object.prototype,S=_.toString,x=O.hasOwnProperty,w=RegExp("^"+S.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const A=function(t){return!(!y(t)||(e=t,g&&g in e))&&(b(t)?w:m).test(function(t){if(null!=t){try{return j.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e},$=function(){try{var t=(e=function(t,e){return null==t?void 0:t[e]}(Object,"defineProperty"),A(e)?e:void 0);return t({},"",{}),t}catch(t){}var e}(),q=function(t,e,r){"__proto__"==e&&$?$(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},E=function(t,e){return t===e||t!=t&&e!=e};var P=Object.prototype.hasOwnProperty;const T=function(t,e,r){var n=t[e];P.call(t,e)&&E(n,r)&&(void 0!==r||e in t)||q(t,e,r)},F=function(t){return t},C=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)};var k=Math.max;const M=$?function(t,e){return $(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:F;var R=Date.now;const I=(L=M,U=0,D=0,function(){var t=R(),e=16-(t-D);if(D=t,e>0){if(++U>=800)return arguments[0]}else U=0;return L.apply(void 0,arguments)});var L,U,D;const B=function(t,e){return I(function(t,e,r){return e=k(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,c=k(n.length-e,0),a=Array(c);++o<c;)a[o]=n[e+o];o=-1;for(var i=Array(e+1);++o<e;)i[o]=n[o];return i[e]=r(a),C(t,this,i)}}(t,e,F),t+"")},N=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},H=function(t){return null!=t&&N(t.length)&&!b(t)};var z=/^(?:0|[1-9]\d*)$/;const G=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&z.test(t))&&t>-1&&t%1==0&&t<e},J=function(t,e,r){if(!y(r))return!1;var n=typeof e;return!!("number"==n?H(r)&&G(e,r.length):"string"==n&&e in r)&&E(r[e],t)},K=function(t){return null!=t&&"object"==typeof t},V=function(t){return K(t)&&"[object Arguments]"==d(t)};var W=Object.prototype,Q=W.hasOwnProperty,X=W.propertyIsEnumerable;const Y=V(function(){return arguments}())?V:function(t){return K(t)&&Q.call(t,"callee")&&!X.call(t,"callee")},Z=Array.isArray;var tt="object"==typeof exports&&exports&&!exports.nodeType&&exports,et=tt&&"object"==typeof module&&module&&!module.nodeType&&module,rt=et&&et.exports===tt?o.Buffer:void 0;const nt=(rt?rt.isBuffer:void 0)||function(){return!1};var ot={};ot["[object Float32Array]"]=ot["[object Float64Array]"]=ot["[object Int8Array]"]=ot["[object Int16Array]"]=ot["[object Int32Array]"]=ot["[object Uint8Array]"]=ot["[object Uint8ClampedArray]"]=ot["[object Uint16Array]"]=ot["[object Uint32Array]"]=!0,ot["[object Arguments]"]=ot["[object Array]"]=ot["[object ArrayBuffer]"]=ot["[object Boolean]"]=ot["[object DataView]"]=ot["[object Date]"]=ot["[object Error]"]=ot["[object Function]"]=ot["[object Map]"]=ot["[object Number]"]=ot["[object Object]"]=ot["[object RegExp]"]=ot["[object Set]"]=ot["[object String]"]=ot["[object WeakMap]"]=!1;var ct="object"==typeof exports&&exports&&!exports.nodeType&&exports,at=ct&&"object"==typeof module&&module&&!module.nodeType&&module,it=at&&at.exports===ct&&r.process,ut=function(){try{return at&&at.require&&at.require("util").types||it&&it.binding&&it.binding("util")}catch(t){}}(),lt=ut&&ut.isTypedArray;const st=lt?function(t){return function(e){return t(e)}}(lt):function(t){return K(t)&&N(t.length)&&!!ot[d(t)]};var pt=Object.prototype.hasOwnProperty;const ft=function(t,e){var r=Z(t),n=!r&&Y(t),o=!r&&!n&&nt(t),c=!r&&!n&&!o&&st(t),a=r||n||o||c,i=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=i.length;for(var l in t)!e&&!pt.call(t,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||c&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||G(l,u))||i.push(l);return i};var dt=Object.prototype;const yt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||dt)};var bt=Object.prototype.hasOwnProperty;const vt=function(t){if(!y(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=yt(t),r=[];for(var n in t)("constructor"!=n||!e&&bt.call(t,n))&&r.push(n);return r},ht=(gt=function(t,e,r,n){!function(t,e,r,n){var o=!r;r||(r={});for(var c=-1,a=e.length;++c<a;){var i=e[c],u=n?n(r[i],t[i],i,r,t):void 0;void 0===u&&(u=t[i]),o?q(r,i,u):T(r,i,u)}}(e,function(t){return H(t)?ft(t,!0):vt(t)}(e),t,n)},B((function(t,e){var r=-1,n=e.length,o=n>1?e[n-1]:void 0,c=n>2?e[2]:void 0;for(o=gt.length>3&&"function"==typeof o?(n--,o):void 0,c&&J(e[0],e[1],c)&&(o=n<3?void 0:o,n=1),t=Object(t);++r<n;){var a=e[r];a&&gt(t,a,r,o)}return t})));var gt;const jt=function(t,e){return function(r){return t(e(r))}},mt=jt(Object.getPrototypeOf,Object);var _t=Function.prototype,Ot=Object.prototype,St=_t.toString,xt=Ot.hasOwnProperty,wt=St.call(Object);const At=function(t){if(!K(t))return!1;var e=d(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!function(t){if(!K(t)||"[object Object]"!=d(t))return!1;var e=mt(t);if(null===e)return!0;var r=xt.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&St.call(r)==wt}(t)},$t=B((function(t,e){try{return C(t,void 0,e)}catch(t){return At(t)?t:new Error(t)}})),qt=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o};var Et=Object.prototype,Pt=Et.hasOwnProperty;const Tt=function(t,e,r,n){return void 0===t||E(t,Et[r])&&!Pt.call(n,r)?e:t};var Ft={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};const Ct=function(t){return"\\"+Ft[t]},kt=jt(Object.keys,Object);var Mt=Object.prototype.hasOwnProperty;const Rt=function(t){return H(t)?ft(t):function(t){if(!yt(t))return kt(t);var e=[];for(var r in Object(t))Mt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)},It=/<%=([\s\S]+?)%>/g,Lt=(Ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(t){return null==Ut?void 0:Ut[t]});var Ut;var Dt=c?c.prototype:void 0,Bt=Dt?Dt.toString:void 0;const Nt=function t(e){if("string"==typeof e)return e;if(Z(e))return qt(e,t)+"";if(function(t){return"symbol"==typeof t||K(t)&&"[object Symbol]"==d(t)}(e))return Bt?Bt.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r},Ht=function(t){return null==t?"":Nt(t)};var zt=/[&<>"']/g,Gt=RegExp(zt.source);const Jt={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:It,variable:"",imports:{_:{escape:function(t){return(t=Ht(t))&&Gt.test(t)?t.replace(zt,Lt):t}}}};var Kt=/\b__p \+= '';/g,Vt=/\b(__p \+=) '' \+/g,Wt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Qt=/[()=,{}\[\]\/\s]/,Xt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Yt=/($^)/,Zt=/['\n\r\u2028\u2029\\]/g,te=Object.prototype.hasOwnProperty;const ee=function(t,e,r){var n=Jt.imports._.templateSettings||Jt;r&&J(t,e,r)&&(e=void 0),t=Ht(t),e=ht({},e,n,Tt);var o,c,a=ht({},e.imports,n.imports,Tt),i=Rt(a),u=function(t,e){return qt(e,(function(e){return t[e]}))}(a,i),l=0,s=e.interpolate||Yt,p="__p += '",f=RegExp((e.escape||Yt).source+"|"+s.source+"|"+(s===It?Xt:Yt).source+"|"+(e.evaluate||Yt).source+"|$","g"),d=te.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+"\n":"";t.replace(f,(function(e,r,n,a,i,u){return n||(n=a),p+=t.slice(l,u).replace(Zt,Ct),r&&(o=!0,p+="' +\n__e("+r+") +\n'"),i&&(c=!0,p+="';\n"+i+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),l=u+e.length,e})),p+="';\n";var y=te.call(e,"variable")&&e.variable;if(y){if(Qt.test(y))throw new Error("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(c?p.replace(Kt,""):p).replace(Vt,"$1").replace(Wt,"$1;"),p="function("+(y||"obj")+") {\n"+(y?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(c?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var b=$t((function(){return Function(i,d+"return "+p).apply(void 0,u)}));if(b.source=p,At(b))throw b;return b};class re{app;static install(t,e={}){t.$modalField=new this(t)}constructor(t){this.app=t}get $ui(){return this.app.inject("$ui")}get $bootstrap(){return this.$ui.bootstrap}createCallback(t,e,r){return"list"===t?t=>{const n=document.querySelector(e);n.querySelector(`[data-value="${t.value}"]`)?alert(u.__("unicorn.field.modal.already.selected")):(n.appendItem(t,!0),u.selectOne(r).close())}:t=>{const n=document.querySelector(e),o=n.querySelector("[data-role=image]"),c=n.querySelector("[data-role=title]"),a=n.querySelector("[data-role=value]");o&&t.image&&(o.style.backgroundImage=`url(${t.image});`),c.value=t.title||"",a.value=t.value||"",a.dispatchEvent(new CustomEvent("change")),u.selectOne(r).close(),u.$ui.highlight(c)}}}class ne extends HTMLElement{static is="uni-modal-list";itemTemplate;options;get listContainer(){return this.querySelector("[data-role=list-container]")}get modal(){return document.querySelector(this.options.modalSelector)}get items(){return Array.from(this.listContainer.children)}connectedCallback(){this.options=JSON.parse(this.getAttribute("options")||"{}"),this.itemTemplate=ee(document.querySelector(this.options.itemTemplate).innerHTML);const t=this.querySelector("[data-role=empty]");t&&(t.name=t.dataset.name),this.options.sortable&&u.import("@sortablejs").then((()=>{new Sortable(this.listContainer,{handle:".h-drag-handle"})}));const e=this.querySelector("[data-role=select]");e.addEventListener("click",(t=>{this.open(t)})),this.querySelector("[data-role=clear]").addEventListener("click",(()=>{this.items.forEach((t=>{t.querySelector("[data-role=remove]").click()}))})),e.style.pointerEvents=null,this.render()}render(){(u.data("unicorn.modal-field")[this.options.dataKey]||[]).forEach((t=>{this.appendItem(t)}))}appendItem(t,e=!1){const r=u.html(this.itemTemplate({item:t}));r.dataset.value=t.value,r.querySelector("[data-role=remove]").addEventListener("click",(()=>{u.$ui.slideUp(r).then((()=>{r.remove(),this.toggleRequired()}))})),this.listContainer.appendChild(r),this.toggleRequired(),e&&u.$ui.highlight(r)}toggleRequired(){const t=this.querySelector("[data-role=validation-placeholder]");t&&(t.disabled=0!==this.listContainer.children.length)}open(t){t.preventDefault(),t.stopPropagation();const e=this.options.max;e&&this.listContainer.children.length>=e?alert(u.__("unicorn.field.modal.max.selected",e)):this.modal.open(t.target.href,{size:"modal-xl"})}}return u.defineCustomElement(ne.is,ne),u.use(re),e})()));
//# sourceMappingURL=main.js.map