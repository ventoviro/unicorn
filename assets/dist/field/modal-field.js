!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ModalField=e():t.ModalField=e()}(self,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{void 0!==c&&c.toStringTag&&Object.defineProperty(t,c.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{ModalField:()=>ne});const r="object"==typeof global&&global&&global.Object===Object&&global;var n="object"==typeof self&&self&&self.Object===Object&&self;const o=r||n||Function("return this")();var c=o.Symbol;const a=c;var i=Object.prototype,l=i.hasOwnProperty,s=i.toString,p=a?a.toStringTag:void 0;var f=Object.prototype.toString;var d=a?a.toStringTag:void 0;const b=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":d&&d in Object(t)?function(t){var e=l.call(t,p),r=t[p];try{t[p]=void 0;var n=!0}catch(t){}var o=s.call(t);return n&&(e?t[p]=r:delete t[p]),o}(t):function(t){return f.call(t)}(t)},v=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},y=function(t){if(!v(t))return!1;var e=b(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},h=o["__core-js_shared__"];var g,j=(g=/[^.]+$/.exec(h&&h.keys&&h.keys.IE_PROTO||""))?"Symbol(src)_1."+g:"";var m=Function.prototype.toString;var _=/^\[object .+?Constructor\]$/,O=Function.prototype,S=Object.prototype,x=O.toString,w=S.hasOwnProperty,A=RegExp("^"+x.call(w).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const $=function(t){return!(!v(t)||(e=t,j&&j in e))&&(y(t)?A:_).test(function(t){if(null!=t){try{return m.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e},q=function(){try{var t=(e=function(t,e){return null==t?void 0:t[e]}(Object,"defineProperty"),$(e)?e:void 0);return t({},"",{}),t}catch(t){}var e}(),E=function(t,e,r){"__proto__"==e&&q?q(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},P=function(t,e){return t===e||t!=t&&e!=e};var T=Object.prototype.hasOwnProperty;const F=function(t,e,r){var n=t[e];T.call(t,e)&&P(n,r)&&(void 0!==r||e in t)||E(t,e,r)},C=function(t){return t},k=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)};var M=Math.max;const R=q?function(t,e){return q(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:C;var I=Date.now;const L=(U=R,D=0,B=0,function(){var t=I(),e=16-(t-B);if(B=t,e>0){if(++D>=800)return arguments[0]}else D=0;return U.apply(void 0,arguments)});var U,D,B;const N=function(t,e){return L(function(t,e,r){return e=M(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,c=M(n.length-e,0),a=Array(c);++o<c;)a[o]=n[e+o];o=-1;for(var i=Array(e+1);++o<e;)i[o]=n[o];return i[e]=r(a),k(t,this,i)}}(t,e,C),t+"")},H=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},z=function(t){return null!=t&&H(t.length)&&!y(t)};var G=/^(?:0|[1-9]\d*)$/;const J=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&G.test(t))&&t>-1&&t%1==0&&t<e},K=function(t,e,r){if(!v(r))return!1;var n=typeof e;return!!("number"==n?z(r)&&J(e,r.length):"string"==n&&e in r)&&P(r[e],t)},V=function(t){return null!=t&&"object"==typeof t},W=function(t){return V(t)&&"[object Arguments]"==b(t)};var Q=Object.prototype,X=Q.hasOwnProperty,Y=Q.propertyIsEnumerable;const Z=W(function(){return arguments}())?W:function(t){return V(t)&&X.call(t,"callee")&&!Y.call(t,"callee")},tt=Array.isArray;var et="object"==typeof exports&&exports&&!exports.nodeType&&exports,rt=et&&"object"==typeof module&&module&&!module.nodeType&&module,nt=rt&&rt.exports===et?o.Buffer:void 0;const ot=(nt?nt.isBuffer:void 0)||function(){return!1};var ct={};ct["[object Float32Array]"]=ct["[object Float64Array]"]=ct["[object Int8Array]"]=ct["[object Int16Array]"]=ct["[object Int32Array]"]=ct["[object Uint8Array]"]=ct["[object Uint8ClampedArray]"]=ct["[object Uint16Array]"]=ct["[object Uint32Array]"]=!0,ct["[object Arguments]"]=ct["[object Array]"]=ct["[object ArrayBuffer]"]=ct["[object Boolean]"]=ct["[object DataView]"]=ct["[object Date]"]=ct["[object Error]"]=ct["[object Function]"]=ct["[object Map]"]=ct["[object Number]"]=ct["[object Object]"]=ct["[object RegExp]"]=ct["[object Set]"]=ct["[object String]"]=ct["[object WeakMap]"]=!1;var at="object"==typeof exports&&exports&&!exports.nodeType&&exports,it=at&&"object"==typeof module&&module&&!module.nodeType&&module,ut=it&&it.exports===at&&r.process,lt=function(){try{return it&&it.require&&it.require("util").types||ut&&ut.binding&&ut.binding("util")}catch(t){}}(),st=lt&&lt.isTypedArray;const pt=st?function(t){return function(e){return t(e)}}(st):function(t){return V(t)&&H(t.length)&&!!ct[b(t)]};var ft=Object.prototype.hasOwnProperty;const dt=function(t,e){var r=tt(t),n=!r&&Z(t),o=!r&&!n&&ot(t),c=!r&&!n&&!o&&pt(t),a=r||n||o||c,i=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=i.length;for(var l in t)!e&&!ft.call(t,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||c&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||J(l,u))||i.push(l);return i};var bt=Object.prototype;const vt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||bt)};var yt=Object.prototype.hasOwnProperty;const ht=function(t){if(!v(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=vt(t),r=[];for(var n in t)("constructor"!=n||!e&&yt.call(t,n))&&r.push(n);return r},gt=(jt=function(t,e,r,n){!function(t,e,r,n){var o=!r;r||(r={});for(var c=-1,a=e.length;++c<a;){var i=e[c],u=n?n(r[i],t[i],i,r,t):void 0;void 0===u&&(u=t[i]),o?E(r,i,u):F(r,i,u)}}(e,function(t){return z(t)?dt(t,!0):ht(t)}(e),t,n)},N((function(t,e){var r=-1,n=e.length,o=n>1?e[n-1]:void 0,c=n>2?e[2]:void 0;for(o=jt.length>3&&"function"==typeof o?(n--,o):void 0,c&&K(e[0],e[1],c)&&(o=n<3?void 0:o,n=1),t=Object(t);++r<n;){var a=e[r];a&&jt(t,a,r,o)}return t})));var jt;const mt=function(t,e){return function(r){return t(e(r))}},_t=mt(Object.getPrototypeOf,Object);var Ot=Function.prototype,St=Object.prototype,xt=Ot.toString,wt=St.hasOwnProperty,At=xt.call(Object);const $t=function(t){if(!V(t))return!1;var e=b(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!function(t){if(!V(t)||"[object Object]"!=b(t))return!1;var e=_t(t);if(null===e)return!0;var r=wt.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&xt.call(r)==At}(t)},qt=N((function(t,e){try{return k(t,void 0,e)}catch(t){return $t(t)?t:new Error(t)}})),Et=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o};var Pt=Object.prototype,Tt=Pt.hasOwnProperty;const Ft=function(t,e,r,n){return void 0===t||P(t,Pt[r])&&!Tt.call(n,r)?e:t};var Ct={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};const kt=function(t){return"\\"+Ct[t]},Mt=mt(Object.keys,Object);var Rt=Object.prototype.hasOwnProperty;const It=function(t){return z(t)?dt(t):function(t){if(!vt(t))return Mt(t);var e=[];for(var r in Object(t))Rt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)},Lt=/<%=([\s\S]+?)%>/g,Ut=(Dt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(t){return null==Dt?void 0:Dt[t]});var Dt;var Bt=a?a.prototype:void 0,Nt=Bt?Bt.toString:void 0;const Ht=function t(e){if("string"==typeof e)return e;if(tt(e))return Et(e,t)+"";if(function(t){return"symbol"==typeof t||V(t)&&"[object Symbol]"==b(t)}(e))return Nt?Nt.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r},zt=function(t){return null==t?"":Ht(t)};var Gt=/[&<>"']/g,Jt=RegExp(Gt.source);const Kt={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Lt,variable:"",imports:{_:{escape:function(t){return(t=zt(t))&&Jt.test(t)?t.replace(Gt,Ut):t}}}};var Vt=/\b__p \+= '';/g,Wt=/\b(__p \+=) '' \+/g,Qt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Xt=/[()=,{}\[\]\/\s]/,Yt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Zt=/($^)/,te=/['\n\r\u2028\u2029\\]/g,ee=Object.prototype.hasOwnProperty;const re=function(t,e,r){var n=Kt.imports._.templateSettings||Kt;r&&K(t,e,r)&&(e=void 0),t=zt(t),e=gt({},e,n,Ft);var o,c,a=gt({},e.imports,n.imports,Ft),i=It(a),u=function(t,e){return Et(e,(function(e){return t[e]}))}(a,i),l=0,s=e.interpolate||Zt,p="__p += '",f=RegExp((e.escape||Zt).source+"|"+s.source+"|"+(s===Lt?Yt:Zt).source+"|"+(e.evaluate||Zt).source+"|$","g"),d=ee.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+"\n":"";t.replace(f,(function(e,r,n,a,i,u){return n||(n=a),p+=t.slice(l,u).replace(te,kt),r&&(o=!0,p+="' +\n__e("+r+") +\n'"),i&&(c=!0,p+="';\n"+i+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),l=u+e.length,e})),p+="';\n";var b=ee.call(e,"variable")&&e.variable;if(b){if(Xt.test(b))throw new Error("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(c?p.replace(Vt,""):p).replace(Wt,"$1").replace(Qt,"$1;"),p="function("+(b||"obj")+") {\n"+(b?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(c?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var v=qt((function(){return Function(i,d+"return "+p).apply(void 0,u)}));if(v.source=p,$t(v))throw v;return v};class ne{app;static install(t,e={}){t.$modalField=new this(t)}constructor(t){this.app=t}get $ui(){return this.app.inject("$ui")}get $bootstrap(){return this.$ui.bootstrap}createCallback(t,e,r){return"list"===t?t=>{const n=document.querySelector(e);n.querySelector(`[data-value="${t.value}"]`)?alert(u.__("unicorn.field.modal.already.selected")):(n.appendItem(t,!0),u.selectOne(r).close())}:t=>{const n=document.querySelector(e),o=n.querySelector("[data-role=image]"),c=n.querySelector("[data-role=title]"),a=n.querySelector("[data-role=value]");o&&t.image&&(o.style.backgroundImage=`url(${t.image});`),c.value=t.title||"",a.value=t.value||"",a.dispatchEvent(new CustomEvent("change")),u.selectOne(r).close(),u.$ui.highlight(c)}}}class oe extends HTMLElement{static is="uni-modal-list";itemTemplate;options;get listContainer(){return this.querySelector("[data-role=list-container]")}get modal(){return document.querySelector(this.options.modalSelector)}get items(){return Array.from(this.listContainer.children)}connectedCallback(){this.options=JSON.parse(this.getAttribute("options")||"{}"),this.itemTemplate=re(document.querySelector(this.options.itemTemplate).innerHTML);const t=this.querySelector("[data-role=empty]");t&&(t.name=t.dataset.name),this.options.sortable&&u.import("@sortablejs").then((()=>{new Sortable(this.listContainer,{handle:".h-drag-handle"})}));const e=this.querySelector("[data-role=select]");e.addEventListener("click",(t=>{this.open(t)})),this.querySelector("[data-role=clear]").addEventListener("click",(()=>{this.items.forEach((t=>{t.querySelector("[data-role=remove]").click()}))})),e.style.pointerEvents=null,this.render()}render(){(u.data("unicorn.modal-field")[this.options.dataKey]||[]).forEach((t=>{this.appendItem(t)}))}appendItem(t,e=!1){const r=u.html(this.itemTemplate({item:t}));r.dataset.value=t.value,r.querySelector("[data-role=remove]").addEventListener("click",(()=>{u.$ui.slideUp(r).then((()=>{r.remove(),this.toggleRequired()}))})),this.listContainer.appendChild(r),this.toggleRequired(),e&&u.$ui.highlight(r)}toggleRequired(){const t=this.querySelector("[data-role=validation-placeholder]");t&&(t.disabled=0!==this.listContainer.children.length)}open(t){t.preventDefault(),t.stopPropagation();const e=this.options.max;e&&this.listContainer.children.length>=e?alert(u.__("unicorn.field.modal.max.selected",e)):this.modal.open(t.target.href,{size:"modal-xl"})}}return u.defineCustomElement(oe.is,oe),u.use(ne),e})()));
//# sourceMappingURL=main.js.map