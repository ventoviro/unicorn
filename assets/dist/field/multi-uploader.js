/*! For license information please see multi-uploader.js.LICENSE.txt */
(()=>{var e={441:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(221),a=r.n(n),o=r(758),i=r.n(o)()(a());i.push([e.id,".vue-drag-uploader{display:flex;flex-wrap:wrap;padding:15px 5px 5px 15px;border:1px dotted #999;border-radius:4px;cursor:pointer;color:#999;min-height:250px}.vue-drag-uploader--readonly{border:1px solid #999}.vue-drag-uploader--ondrag{border:1px dotted #666;background-color:rgba(0,0,0,0.05);color:#666}.vue-drag-uploader__draggable-wrapper,.vue-drag-uploader__transition-wrapper{display:flex;flex-wrap:wrap}.vue-drag-uploader__item{width:155px;height:155px;border:1px solid rgba(0,0,0,0.25);border-radius:3px;cursor:pointer;margin-right:15px;margin-bottom:15px}.vue-drag-uploader .add-button{display:flex;align-items:center;text-align:center;transition:background-color .5s}.vue-drag-uploader .add-button:hover{background-color:rgba(0,0,0,0.05)}.vue-drag-uploader .add-button__body{margin:0 auto}.vue-drag-uploader .add-button__icon{margin-bottom:10px}.vue-drag-uploader .add-button__text{font-size:14px}.vue-drag-uploader .preview-img{position:relative;cursor:pointer;padding:1px}.vue-drag-uploader .preview-img>*{position:absolute}.vue-drag-uploader .preview-img:hover .error-message__message{display:block;padding:10px}.vue-drag-uploader .preview-img__body{left:0;top:0;width:100%;height:100%;background:transparent no-repeat center center;background-size:cover}.vue-drag-uploader .preview-img__title{margin:0 auto}.vue-drag-uploader .preview-img__overlay{display:flex;align-items:center;left:0;top:0;bottom:0;right:0;background-color:rgba(0,0,0,0.35);opacity:0;transition:opacity .5s}.vue-drag-uploader .preview-img__overlay:hover{opacity:1}.vue-drag-uploader .preview-img__remove-icon{position:absolute;top:5px;right:5px;color:white;opacity:.75;transition:opacity .5s}.vue-drag-uploader .preview-img__remove-icon:hover{opacity:1}.vue-drag-uploader .preview-img__progress{height:5px;background-color:rgba(255,255,255,0.8);width:100%;bottom:0;left:0}.vue-drag-uploader .preview-img__progress-bar{background-color:var(--bs-primary, #007bff);width:0;height:100%}.vue-drag-uploader .error-message{width:100%;background-color:#dc3545;color:white;font-size:14px;word-break:break-all;top:calc(100% - 26px);min-height:26px}.vue-drag-uploader .error-message__notice{display:inline-block;padding:3px;text-align:center;width:100%}.vue-drag-uploader .error-message__message{display:none}\n","",{version:3,sources:["webpack://./scss/field/vue-drag-uploader.scss"],names:[],mappings:"AAKA,mBACE,YAAa,CACb,cAAe,CACf,yBAA0B,CAC1B,sBAAuB,CACvB,iBAAkB,CAClB,cAAe,CACf,UAAW,CACX,gBAAiB,CAEjB,6BACE,qBAAsB,CACvB,2BAGC,sBAAuB,CACvB,iCAAoC,CACpC,UAAW,CACZ,6EAIC,YAAa,CACb,cAAe,CAChB,yBAGC,WA9Ba,CA+Bb,YA9Bc,CA+Bd,iCAAoC,CACpC,iBAAkB,CAClB,cAAe,CACf,iBAAkB,CAClB,kBAAmB,CAjCvB,+BAqCI,YAAa,CACb,kBAAmB,CACnB,iBAAkB,CAClB,+BAAgC,CAxCpC,qCA2CM,iCAAoC,CA3C1C,qCA+CM,aAAc,CA/CpB,qCAmDM,kBAAmB,CAnDzB,qCAuDM,cAAe,CAvDrB,gCA4DI,iBAAkB,CAClB,cAAe,CACf,WAAY,CA9DhB,kCAiEM,iBAAkB,CAjExB,8DAuEU,aAAc,CACd,YAAa,CAxEvB,sCA8EM,MAAO,CACP,KAAM,CACN,UAAW,CACX,WAAY,CACZ,8CAA+C,CAC/C,qBAAsB,CAnF5B,uCAuFM,aAAc,CAvFpB,yCA2FM,YAAa,CACb,kBAAmB,CACnB,MAAO,CACP,KAAM,CACN,QAAS,CACT,OAAQ,CACR,iCAAoC,CACpC,SAAU,CACV,sBAAuB,CAnG7B,+CAsGQ,SAAU,CAtGlB,6CA2GM,iBAAkB,CAClB,OAAQ,CACR,SAAU,CACV,WAAY,CACZ,WAAY,CACZ,sBAAuB,CAhH7B,mDAmHQ,SAAU,CAnHlB,0CAwHM,UAAW,CACX,sCAAyC,CACzC,UAAW,CACX,QAAS,CACT,MAAO,CA5Hb,8CAgIM,2CAA4C,CAC5C,OAAQ,CACR,WAAY,CAlIlB,kCAuII,UAAW,CACX,wBAAyB,CACzB,WAAY,CACZ,cAAe,CACf,oBAAqB,CACrB,qBAAsB,CACtB,eAAgB,CA7IpB,0CAgJM,oBAAqB,CACrB,WAAY,CACZ,iBAAkB,CAClB,UAAW,CAnJjB,2CAuJM,YAAa",sourcesContent:["// Part of ke file.\n\n$img-width: 155px !default;\n$img-height: 155px !default;\n\n.vue-drag-uploader {\n  display: flex;\n  flex-wrap: wrap;\n  padding: 15px 5px 5px 15px;\n  border: 1px dotted #999;\n  border-radius: 4px;\n  cursor: pointer;\n  color: #999;\n  min-height: 250px;\n\n  &--readonly {\n    border: 1px solid #999;\n  }\n\n  &--ondrag {\n    border: 1px dotted #666;\n    background-color: rgba(0, 0, 0, .05);\n    color: #666;\n  }\n\n  &__draggable-wrapper,\n  &__transition-wrapper {\n    display: flex;\n    flex-wrap: wrap;\n  }\n\n  &__item {\n    width: $img-width;\n    height: $img-height;\n    border: 1px solid rgba(0, 0, 0, .25);\n    border-radius: 3px;\n    cursor: pointer;\n    margin-right: 15px;\n    margin-bottom: 15px;\n  }\n\n  .add-button {\n    display: flex;\n    align-items: center;\n    text-align: center;\n    transition: background-color .5s;\n\n    &:hover {\n      background-color: rgba(0, 0, 0, .05);\n    }\n\n    &__body {\n      margin: 0 auto;\n    }\n\n    &__icon {\n      margin-bottom: 10px;\n    }\n\n    &__text {\n      font-size: 14px;\n    }\n  }\n\n  .preview-img {\n    position: relative;\n    cursor: pointer;\n    padding: 1px;\n\n    > * {\n      position: absolute;\n    }\n\n    &:hover {\n      .error-message {\n        &__message {\n          display: block;\n          padding: 10px;\n        }\n      }\n    }\n\n    &__body {\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      background: transparent no-repeat center center;\n      background-size: cover;\n    }\n\n    &__title {\n      margin: 0 auto;\n    }\n\n    &__overlay {\n      display: flex;\n      align-items: center;\n      left: 0;\n      top: 0;\n      bottom: 0;\n      right: 0;\n      background-color: rgba(0, 0, 0, .35);\n      opacity: 0;\n      transition: opacity .5s;\n\n      &:hover {\n        opacity: 1;\n      }\n    }\n\n    &__remove-icon {\n      position: absolute;\n      top: 5px;\n      right: 5px;\n      color: white;\n      opacity: .75;\n      transition: opacity .5s;\n\n      &:hover {\n        opacity: 1;\n      }\n    }\n\n    &__progress {\n      height: 5px;\n      background-color: rgba(255, 255, 255, .8);\n      width: 100%;\n      bottom: 0;\n      left: 0;\n    }\n\n    &__progress-bar {\n      background-color: var(--bs-primary, #007bff);\n      width: 0;\n      height: 100%;\n    }\n  }\n\n  .error-message {\n    width: 100%;\n    background-color: #dc3545;\n    color: white;\n    font-size: 14px;\n    word-break: break-all;\n    top: calc(100% - 26px);\n    min-height: 26px;\n\n    &__notice {\n      display: inline-block;\n      padding: 3px;\n      text-align: center;\n      width: 100%;\n    }\n\n    &__message {\n      display: none;\n    }\n  }\n}\n"],sourceRoot:""}]);const l=i},758:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(i[s]=!0)}for(var d=0;d<e.length;d++){var u=[].concat(e[d]);n&&i[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),r&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=r):u[2]=r),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),t.push(u))}},t}},221:e=>{"use strict";e.exports=function(e){var t=e[1],r=e[3];if(!r)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),o="/*# ".concat(a," */");return[t].concat([o]).join("\n")}return[t].join("\n")}},789:(e,t)=>{"use strict";t.Z=(e,t)=>{const r=e.__vccOpts||e;for(const[e,n]of t)r[e]=n;return r}},373:(e,t,r)=>{var n=r(441);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),(0,r(840).Z)("4b61d991",n,!0,{})},840:(e,t,r)=>{"use strict";function n(e,t){for(var r=[],n={},a=0;a<t.length;a++){var o=t[a],i=o[0],l={id:e+":"+a,css:o[1],media:o[2],sourceMap:o[3]};n[i]?n[i].parts.push(l):r.push(n[i]={id:i,parts:[l]})}return r}r.d(t,{Z:()=>g});var a="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},i=a&&(document.head||document.getElementsByTagName("head")[0]),l=null,s=0,d=!1,u=function(){},p=null,c="data-vue-ssr-id",m="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(e,t,r,a){d=r,p=a||{};var i=n(e,t);return f(i),function(t){for(var r=[],a=0;a<i.length;a++){var l=i[a];(s=o[l.id]).refs--,r.push(s)}for(t?f(i=n(e,t)):i=[],a=0;a<r.length;a++){var s;if(0===(s=r[a]).refs){for(var d=0;d<s.parts.length;d++)s.parts[d]();delete o[s.id]}}}}function f(e){for(var t=0;t<e.length;t++){var r=e[t],n=o[r.id];if(n){n.refs++;for(var a=0;a<n.parts.length;a++)n.parts[a](r.parts[a]);for(;a<r.parts.length;a++)n.parts.push(h(r.parts[a]));n.parts.length>r.parts.length&&(n.parts.length=r.parts.length)}else{var i=[];for(a=0;a<r.parts.length;a++)i.push(h(r.parts[a]));o[r.id]={id:r.id,refs:1,parts:i}}}}function A(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function h(e){var t,r,n=document.querySelector("style["+c+'~="'+e.id+'"]');if(n){if(d)return u;n.parentNode.removeChild(n)}if(m){var a=s++;n=l||(l=A()),t=b.bind(null,n,a,!1),r=b.bind(null,n,a,!0)}else n=A(),t=y.bind(null,n),r=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else r()}}var v,C=(v=[],function(e,t){return v[e]=t,v.filter(Boolean).join("\n")});function b(e,t,r,n){var a=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=C(t,a);else{var o=document.createTextNode(a),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(o,i[t]):e.appendChild(o)}}function y(e,t){var r=t.css,n=t.media,a=t.sourceMap;if(n&&e.setAttribute("media",n),p.ssrId&&e.setAttribute(c,t.id),a&&(r+="\n/*# sourceURL="+a.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";const e=Vue,t={class:"vue-drag-uploader__wrapper"},n={class:"add-button__body"},a=(0,e.createElementVNode)("div",{class:"add-button__icon"},[(0,e.createElementVNode)("span",{class:"fa fa-upload fa-2x"})],-1),o={class:"add-button__text"};r(373);const i={key:1,class:"preview-img__body d-flex justify-content-center align-items-center"},l={class:"text-center"},s={style:{"word-break":"break-word"}},d={class:"preview-img__overlay"},p={key:2,class:"preview-img__progress"},c=(0,e.createElementVNode)("span",{class:"error-message__notice"},"Upload fail",-1),m={class:"error-message__message"};function g(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}g(class{static install(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.$queue=new this(e,t);e.queue=r.get.bind(r)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g(this,"queues",{}),this.app=e,this.$options=t}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(null==name)throw new Error("Please provide a name.");return new f(e)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(null==e)throw new Error("Please provide a name.");return this.queues[e]||(this.queues[e]=this.create(t)),this.queues[e]}set(e,t){if(null==e)throw new Error("Please provide a name.");return this.queues[e]=t,this}remove(e){return delete this.queues[e],this}all(){return this.queues}},"is","queue");class f{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;g(this,"items",[]),g(this,"maxRunning",1),g(this,"currentRunning",0),g(this,"running",!1),g(this,"observers",[]),this.maxRunning=e}push(e){const t=new Promise(((t,r)=>{this.items.push((()=>Promise.resolve(e()).then(t)))}));return this.run(),t}run(){this.running||(this.running=!0),this.pop()}pop(){const e=this.items.shift();return e?this.currentRunning>=this.maxRunning?(this.items.unshift(e),Promise.resolve()):(this.currentRunning++,this.notice(),e().then((e=>(this.endPop(),e))).catch((e=>(this.endPop(),Promise.reject(e))))):(this.running=!1,Promise.resolve())}endPop(){this.currentRunning--,this.notice(),this.pop()}clear(){return this.items=[],this.notice(),this}isEmpty(){return 0===this.items.length}get length(){return this.items.length}peek(){return this.items}observe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.observers.push({handler:e,once:t.once||!1}),()=>{this.off(e)}}once(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.once=!0,this.observe(e,t)}onEnd(e){return this.observe(((t,r,n)=>{0===r&&0===n&&e(t,r,n)}))}notice(){return this.observers.forEach((e=>{e.handler(this,this.length,this.currentRunning)})),this.observers=this.observers.filter((e=>!0!==e.once)),this}off(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===e?(this.observers=[],this):(this.observers=this.observers.filter((t=>t.handler!==e)),this)}}let A;A=window.swal=window.swal||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;alert(e+" / "+t)};const h="completed",v={},{ref:C,reactive:b,computed:y,watch:x,toRefs:w,onMounted:k}=e,B={name:"vue-drag-uploader-item",props:{item:Object,i:Number,initState:String,uploadUrl:String,size:Number,isReadonly:Boolean,queueName:{type:String,default:"uploading"},maxConcurrent:[String,Number]},setup(e,t){let{emit:r}=t;const n=b({state:h,progress:0,messages:{error:""}});function a(){n.state="uploading";const t=(new Date).valueOf(),a=new FormData;return a.append("file",e.item.file),e.item.title=e.item.title||e.item.file.name,r("upload-start",t),u.$http.post(e.uploadUrl,a,{onUploadProgress:e=>{e.lengthComputable&&(n.progress=e.loaded/e.total,r("upload-progress",t,n.progress))}}).then((t=>{n.state=h,e.item.url=t.data.data.url,e.item.download_url=t.data.data.download_url,i.value&&(e.item.thumb_url=t.data.data.thumb_url||t.data.data.url)})).catch((e=>{console.error(e),n.state="fail",n.messages.error=e.message||xhr.responseJSON.message})).finally((()=>{e.item.file=null,r("upload-end",t)}))}n.state=e.initState,e.initState,k((()=>{if("new"===e.initState){const t=new FileReader;t.onload=t=>{e.item.thumb_url=t.target.result},t.readAsDataURL(e.item.file);const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return v[e]=v[e]||new f(t),v[e]}(e.queueName,Number(e.maxConcurrent)||2);r.push((()=>a()))}}));const o=y((()=>e.item.file?e.item.file.name:e.item.title?e.item.title:e.item.url.split("/").pop())),i=y((()=>function(e){const t=e.split(".").pop().split("?").shift();return-1!==["png","jpeg","jpg","gif","bmp","webp"].indexOf(t.toLowerCase())}(e.item.file?e.item.file.name:e.item.url))),l=y((()=>({pdf:"fas fa-file-pdf text-danger",xls:"fas fa-file-excel text-success",xlsx:"fas fa-file-excel text-success",doc:"fas fa-file-word text-primary",docx:"fas fa-file-word text-primary",ppt:"fas fa-file-powerpoint text-warning",pptx:"fas fa-file-powerpoint text-warning",zip:"fas fa-file-archive text-dark","7z":"fas fa-file-archive text-dark",rar:"fas fa-file-archive text-dark",mp4:"fas fa-file-video text-dark",avi:"fas fa-file-video text-dark",flv:"fas fa-file-video text-dark",mov:"fas fa-file-video text-dark",ogg:"fas fa-file-video text-dark",webm:"fas fa-file-video text-dark",mpg:"fas fa-file-video text-dark",mp3:"fas fa-file-audio text-dark",acc:"fas fa-file-audio text-dark",wav:"fas fa-file-audio text-dark"}[(e.item.file?e.item.file.name.split(".").pop():e.item.url.split(".").pop()).toLowerCase()]||"fas fa-file")));return{...w(n),upload:a,deleteSelf:function(){e.isReadonly||r("delete",e.item)},onClick:function(t){r("item-click",e.item,e.i,t)},isImage:i,icon:l,fileName:o}}};var _=r(789);const S=(0,_.Z)(B,[["render",function(t,r,n,a,o,u){return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:"vue-drag-uploader__item preview-img",style:(0,e.normalizeStyle)({width:n.size?n.size+"px":null,height:n.size?n.size+"px":null}),onClick:r[2]||(r[2]=function(){return a.onClick&&a.onClick(...arguments)})},[(0,e.renderSlot)(t.$slots,"it",{item:n.item},(()=>[a.isImage?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"preview-img__body",style:(0,e.normalizeStyle)({"background-image":"url("+(n.item.thumb_url||n.item.url)+")"})},null,4)):(0,e.createCommentVNode)("",!0),(0,e.createTextVNode)(),a.isImage?(0,e.createCommentVNode)("",!0):((0,e.openBlock)(),(0,e.createElementBlock)("div",i,[(0,e.createElementVNode)("div",l,[(0,e.createElementVNode)("div",null,[(0,e.createElementVNode)("span",{class:(0,e.normalizeClass)([a.icon,"fa-3x"])},null,2)]),(0,e.createTextVNode)(),(0,e.createElementVNode)("div",s,(0,e.toDisplayString)(a.fileName),1)])])),(0,e.createTextVNode)(),(0,e.createElementVNode)("div",d,[n.isReadonly?(0,e.createCommentVNode)("",!0):((0,e.openBlock)(),(0,e.createElementBlock)("span",{key:0,class:"preview-img__remove-icon fa fa-times",onClick:r[0]||(r[0]=(0,e.withModifiers)((e=>a.deleteSelf()),["stop","prevent"]))})),(0,e.createTextVNode)(),(0,e.renderSlot)(t.$slots,"extra",{item:n.item})]),(0,e.createTextVNode)(),"uploading"===t.state?((0,e.openBlock)(),(0,e.createElementBlock)("div",p,[(0,e.createElementVNode)("div",{class:"preview-img__progress-bar",style:(0,e.normalizeStyle)({width:100*t.progress+"%"})},null,4)])):(0,e.createCommentVNode)("",!0),(0,e.createTextVNode)(),"fail"===t.state?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:3,class:"preview-img__error-message error-message",onClick:r[1]||(r[1]=(0,e.withModifiers)((()=>{}),["stop","prevent"]))},[c,(0,e.createTextVNode)(),(0,e.createElementVNode)("span",m,(0,e.toDisplayString)(t.messages.error),1)])):(0,e.createCommentVNode)("",!0)]))],4)}]]),{ref:E,reactive:N,toRefs:V,onMounted:M,computed:P,watch:U}=e,R={name:"vue-drag-uploader",components:{VueDragUploaderItem:S},props:{id:String,url:String,modelValue:{type:Array,default:()=>[]},maxFiles:[String,Number],maxConcurrent:[String,Number],thumbSize:Number,placeholder:String,accept:{type:String,default:""},disabled:{default:!1},readonly:{default:!1}},setup(e,t){let{emit:r}=t;const n=E(null),a=N({items:[],uploadQueue:{}}),o=P((()=>e.modelValue));function i(){const e=new Date;return e.getTime()+"."+e.getMilliseconds()+"."+Math.random()}function l(e){Array.prototype.forEach.call(e,s),Array.prototype.forEach.call(e,(e=>{if(s(e),!p.value)return;const t={id:"",key:i(),url:"",thumb_url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",uploadState:"new",file:e,title:"",alt:"",description:""};a.items.push(t)}))}function s(e){const t=m.value,r=e.name.split(".").pop();if(t.length){let n=!1;if(t.forEach((t=>{n||(-1!==t.indexOf("/")?d(t,e.type)&&(n=!0):t.toLowerCase()===r.toLowerCase()&&(n=!0))})),!n)throw A(u.__("unicorn.field.file.drag.message.unaccepted.files"),u.__("unicorn.field.file.drag.message.unaccepted.files.desc",t.join(", ")),"warning"),new Error("Not accepted file ext")}}function d(e,t){const r=e.split("/"),n=t.split("/");return"*"===r[1]?r[0]===n[0]:e===t}M((()=>{!function(e,t){e.value.addEventListener("dragover",(e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.add("vue-drag-uploader--ondrag")})),e.value.addEventListener("dragleave",(e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.remove("vue-drag-uploader--ondrag")})),e.value.addEventListener("drop",(e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.remove("vue-drag-uploader--ondrag");const r=e.dataTransfer.items,n=[],a=e=>{const t=[];if(o.length,e.isDirectory){const r=e.createReader();t.push(new Promise((e=>{const t=[];r.readEntries((r=>{r.forEach((e=>{t.push(a(e))})),Promise.all(t).then(e)}))})))}else t.push(new Promise((t=>{e.file((e=>{n.push(e),t(e)}))})));return Promise.all(t)},o=[],i=[];Array.prototype.forEach.call(r,(e=>{e.webkitGetAsEntry()&&i.push(a(e.webkitGetAsEntry()))})),i.length&&Promise.all(i).then((e=>{t(n)}))}))}(n,l)})),e.modelValue.map((e=>{e.key=e.key||i(),e.uploadState=h})),a.items.push(...e.modelValue),null!=e.maxFiles&&e.maxFiles<a.items.length&&a.items.splice(e.maxFiles);const p=P((()=>(null==e.maxFiles||a.items.length<e.maxFiles)&&!g.value)),c=P((()=>(Object.keys(a.uploadQueue),Object.keys(a.uploadQueue).length>0))),m=P((()=>(Array.isArray(e.accept)?e.accept:e.accept.split(",")).map((e=>e.trim())).filter((e=>e.length>0)).map((e=>-1===e.indexOf("/")&&"."===e[0]?e.substr(1):e)))),g=P((()=>e.disabled||e.readonly));return U(o,(e=>{e.map((e=>{e.key=e.key||i()})),JSON.stringify(e)!==JSON.stringify(a.items)&&(a.items=e)}),{deep:!0}),U((()=>a.items),(e=>{r("update:modelValue",e)}),{deep:!0}),U(c,(e=>{r(e?"uploading":"uploaded")})),{el:n,...V(a),clickAdd:function(){const t=document.createElement("INPUT");t.setAttribute("id","luna-multi-uploader-selector"),t.setAttribute("type","file"),t.setAttribute("accept",e.accept),t.setAttribute("multiple",!0),t.style.display="none",t.addEventListener("change",(e=>{l(e.target.files),t.remove()})),t.addEventListener("change",(e=>{t.remove()})),document.body.appendChild(t),t.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))},getKey:i,uploadFiles:l,checkFile:s,compareMimeType:d,deleteItem:function(e){r("delete-item",e),a.items=a.items.filter((t=>t.key!==e.key))},uploadStart:function(e){a.uploadQueue[e]=0},uploadEnd:function(e){delete a.uploadQueue[e]},uploadProgress:function(e,t){a.uploadQueue[e]=t},itemClick:function(e,t,n){r("item-click",e,t,n)},canUpload:p,uploading:c,acceptedTypes:m,isReadonly:g}}},j=(0,_.Z)(R,[["render",function(r,i,l,s,d,u){const p=(0,e.resolveComponent)("vue-drag-uploader-item"),c=(0,e.resolveComponent)("draggable");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{ref:"el",class:(0,e.normalizeClass)(["vue-drag-uploader",{"vue-drag-uploader--readonly":s.isReadonly}])},[(0,e.createElementVNode)("div",t,[(0,e.createVNode)(c,(0,e.mergeProps)({modelValue:r.items,"onUpdate:modelValue":i[1]||(i[1]=e=>r.items=e),class:"vue-drag-uploader__draggable-wrapper"},{draggable:".preview-img",animation:300},{disabled:s.isReadonly,onSort:i[2]||(i[2]=e=>r.$emit("reorder",e)),"item-key":"key"}),{item:(0,e.withCtx)((t=>{let{element:n,index:a}=t;return[((0,e.openBlock)(),(0,e.createBlock)(p,{item:n,i:a,"init-state":n.uploadState,key:n.key,ref:n.key,"upload-url":l.url,size:l.thumbSize,"is-readonly":s.isReadonly,"queue-name":l.id,"max-concurrent":l.maxConcurrent,onDelete:s.deleteItem,onUploadStart:s.uploadStart,onUploadEnd:s.uploadEnd,onUploadProgress:s.uploadProgress,onItemClick:s.itemClick,style:{"animation-duration":".3s"}},{extra:(0,e.withCtx)((()=>[(0,e.renderSlot)(r.$slots,"extra",{item:n,i:a,url:l.url,maxFiles:l.maxFiles,thumbSize:l.thumbSize,filesLimited:l.maxFiles})])),_:2},1032,["item","i","init-state","upload-url","size","is-readonly","queue-name","max-concurrent","onDelete","onUploadStart","onUploadEnd","onUploadProgress","onItemClick"]))]})),footer:(0,e.withCtx)((()=>[s.canUpload?((0,e.openBlock)(),(0,e.createElementBlock)("div",{class:"vue-drag-uploader__item add-button",key:"empty",onClick:i[0]||(i[0]=e=>s.clickAdd()),style:(0,e.normalizeStyle)({width:l.thumbSize?l.thumbSize+"px":null,height:l.thumbSize?l.thumbSize+"px":null})},[(0,e.createElementVNode)("div",n,[a,(0,e.createTextVNode)(),(0,e.createElementVNode)("div",o,(0,e.toDisplayString)(l.placeholder),1)])],4)):(0,e.createCommentVNode)("",!0)])),_:3},16,["modelValue","disabled"])])],2)}]]),z=j;class T extends HTMLElement{connectedCallback(){const t=JSON.parse(this.getAttribute("options")||"{}");this.modalElement=this.querySelector(".modal");const r=t.tmplSelector||"#multi-uploader-field-tmpl";u.importSync("@sortablejs","@vuedraggable").then((()=>{const n=(0,e.createApp)({name:"multi-uploader-field"});var a;n.component("app",(a=t,{name:"multi-uploader-field-app",template:document.querySelector(r).innerHTML,props:{stackName:String},setup(t,r){const n=(0,e.reactive)({...a,current:null,currentIndex:null,loading:!1}),o=(0,e.ref)(null),i=(0,e.ref)(null),l=(0,e.ref)(null);return{app:l,modal:i,state:n,dragarea:o,...(0,e.toRefs)(n),test:function(){n.current={foo:123}},openFile:function(e){n.openFileHandler?n.openFileHandler(e):window.open(e.download_url||e.url)},itemClick:function(t,r,a){n.current=t,n.currentIndex=r,(0,e.nextTick)().then((()=>{new bootstrap.Modal(i.value).show()}))},metaSave:function(){n.current=null,n.currentIndex=null},isImage:function(e){const t=e.split(".").pop().split("?").shift();return-1!==["png","jpeg","jpg","gif","bmp","webp"].indexOf(t.toLowerCase())},dragover:function(e){n.canReplace&&(o.value.style.opacity=.75)},dragleave:function(e){n.canReplace&&(o.value.style.opacity=1)},drop:function(e){if(!n.canReplace)return;o.value.style.opacity=1;const t=n.current,r=e.dataTransfer.files[0];if(l.value.checkFile(r),l.value.isReadonly)return;new FileReader,t.file=r;const a=l.value.$refs[t.key];n.loading=!0,a.upload().finally((()=>{n.loading=!1}))},uploading:function(){u.stack(t.stackName).push(!0)},uploaded:function(){u.stack(t.stackName).pop()}}}})),n.component("draggable",vuedraggable),n.component("vue-drag-uploader",z),n.mount(this),this.vm=n}))}}var O,q,I;O=T,I="multi-uploader",(q=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(q="is"))in O?Object.defineProperty(O,q,{value:I,enumerable:!0,configurable:!0,writable:!0}):O[q]=I,u.defineCustomElement(T.is,T)})()})();
//# sourceMappingURL=multi-uploader.js.map